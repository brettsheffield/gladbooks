# gladd.conf
# 
# this file is part of GLADD
# 
# Copyright (c) 2012, 2013 Brett Sheffield <brett@gladserv.com>
# 
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program (see the file COPYING in the distribution).
# If not, see <http://www.gnu.org/licenses/>.

debug		1
port		3000
daemon		0
encoding	UTF-8
url_default	/html/index.html
xmlpath         /home/bacs/dev/gladbooks-ui/xml/

###############################################################################
## databases
db      gb		pg	localhost       	 gladbooks
db      ldap1       	ldap    ldap://ldap.gladserv.com dc=gladserv,dc=com

###############################################################################
# urls (tried in order of appearance)
###############################################################################
url     static  GET  /css/*	/home/bacs/dev/gladbooks-ui/css/
url     static  GET  /js/*	/home/bacs/dev/gladbooks-ui/js/
url     static  GET  /html/*	/home/bacs/dev/gladbooks-ui/html/
url     static  GET  /img/*	/home/bacs/dev/gladbooks-ui/img/

url	sqlview GET  /*/*/accounts/*   			gb accountlist
url	sqlview GET  /*/*/accounttypes/  		gb accounttype
url     sqlview GET  /auth/*				gb auth
url	sqlview GET  /*/*/businesses/* 			gb businesses
url	sqlview GET  /*/*/contactlist/ 			gb contactlist
url	sqlview GET  /*/*/contacts/* 			gb contactdetail
url	sqlview GET  /*/*/departments/*			gb department
url	sqlview GET  /*/*/divisions/*			gb division
url	sqlview GET  /*/*/instances/* 			gb instances
url	sqlview GET  /*/*/journals/*			gb journal
url	sqlview GET  /*/*/ledgers/*			gb ledger
url	sqlview GET  /*/*/organisations/* 		gb organisationlist
url	sqlview GET  /*/*/organisation_contacts/*/ 	gb org_contact
url	sqlview GET  /*/*/reports/balancesheet/ 	gb balancesheet
url	sqlview GET  /*/*/reports/profitandloss/ 	gb profitandloss

url	sqlview DELETE /*/*/organisation_contacts/*	gb org_contact_del

url	xslpost POST /*/*/accounts/*			gb account
url	xslpost POST /*/*/businesses/*			gb business
url	xslpost POST /*/*/contacts/*			gb contact
url	xslpost POST /*/*/departments/*			gb department
url	xslpost POST /*/*/divisions/*			gb division
url	xslpost POST /*/*/instances/*			gb instance
url	xslpost POST /*/*/journals/*			gb journal
url	xslpost POST /*/*/organisations/*		gb organisation
url	xslpost POST /*/*/organisation_contacts/*	gb organisation_contact

###############################################################################
# acls (tried in order of appearance)
###############################################################################
acl	GET	/css/*				allow	*
acl	GET	/js/*				allow	*
acl	GET	/html/*				allow	*
acl	GET	/media/*			allow	*
acl	GET	/img/*				allow	*
acl	GET	/*/*/*				require	*
acl	POST	/*/*/*				require	*
acl	GET	/auth/*				require	*
acl	DELETE	/*/*/organisation_contacts/*	require *

###############################################################################
## auth
auth    ldap    ldap    ldap1   ld_auth         uid

###############################################################################
# sql
# Rather than creating lengthy SQL queries here, create a view in the database
# and SELECT * FROM <view>
#
# variable substitutions:
# $0 = instance
# $1 = business
###############################################################################
sql accountlist		SELECT * FROM gladbooks_$0_$1.accountlist
sql accounttype		SELECT * FROM gladbooks_$0_$1.accounttype ORDER by id ASC
sql auth		SELECT * FROM gladbooks.username
sql balancesheet	SELECT * FROM gladbooks_$0_$1.balancesheet
sql businesses		SELECT * FROM gladbooks_$0.business ORDER BY name ASC
sql contactdetail	SELECT * FROM gladbooks_$0.contactdetailview
sql contactlist		SELECT * FROM gladbooks_$0.contactlist
sql department		SELECT * FROM gladbooks_$0_$1.department

begin sql org_contact_del
	DELETE FROM gladbooks_$0.organisation_contact 
	WHERE organisation='$3' AND contact='$4';
	SELECT id, name, phone, mobile, email 
	FROM gladbooks_$0.contactdetailview cdv
	WHERE cdv.id IN (
		SELECT contact
		FROM gladbooks_$0.organisation_contact
		WHERE organisation='$3'
	)
end sql org_contact_del

sql division		SELECT * FROM gladbooks_$0_$1.division
sql instances		SELECT * FROM gladbooks.instance
sql journal		SELECT * FROM gladbooks_$0_$1.journal
sql ledger		SELECT * FROM gladbooks_$0_$1.ledger
sql organisationlist	SELECT * FROM gladbooks_$0.organisationlist

begin sql org_contact	
	SELECT id, name, phone, mobile, email 
	FROM gladbooks_$0.contactdetailview cdv
	WHERE cdv.id IN (
		SELECT contact
		FROM gladbooks_$0.organisation_contact
		WHERE organisation='$3'
	)
end sql org_contact

sql profitandloss	SELECT * FROM gladbooks_$0_$1.profitandloss
sql salesinvoice	SELECT * FROM gladbooks_$0_$1.salesinvoice
sql test		SELECT * FROM test

sql ld_auth		ou=people
sql ld_group		ou=group
